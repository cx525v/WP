import { assert } from 'chai';
import { Component, OnInit, ElementRef, EventEmitter, Input, Output, OnChanges, SimpleChanges, SimpleChange } from '@angular/core';
import { TestBed, async, ComponentFixture, inject, fakeAsync, tick } from '@angular/core/testing';
import { BrowserDynamicTestingModule, platformBrowserDynamicTesting } from "@angular/platform-browser-dynamic/testing";
import { HttpModule, XHRBackend, Response, ResponseOptions, Http, BaseRequestOptions, ConnectionBackend } from '@angular/http';
import { MockBackend } from '@angular/http/testing';
import { BrowserAnimationsModule } from '@angular/platform-browser/animations';
import { FormGroup, FormControl, Validators, FormsModule, ReactiveFormsModule } from '@angular/forms';
import { DebugElement } from '@angular/core';
import { NoopAnimationsModule } from '@angular/platform-browser/animations';
import { Observable } from 'rxjs/Observable';
import 'rxjs/add/observable/of';
import { By } from '@angular/platform-browser';
import {
    TabViewModule, DataTableModule, FileUploadModule, ButtonModule,
    TreeModule, DropdownModule, DialogModule, CheckboxModule, DataGridModule,
    ConfirmDialogModule, PanelModule, GrowlModule, MessagesModule, AutoCompleteModule, CalendarModule
} from 'primeng/primeng';
import {
    DataTable, ConfirmationService, Dropdown, TabView, SelectItem,
    Dialog, ConfirmDialog, Panel, Growl, Message, Messages, AutoComplete, Calendar
} from 'primeng/primeng';
import { TEST_BASESERVER } from '../../../../shared/spec.global.component';
import { TableSchemaComponent } from './tableschema.component';
import { EPSTableloadService } from '../../../../services/petro/epstableload.service';
import { XmlService } from '../../../../services/petro/Xml.service';
import { DatePipe } from '@angular/common';
import { PetroTable, UpdateXmlModel, Updates, Tree } from '../../../../models/petro/petroTable.model';
import { commanderversion, commanderbaseversion } from '../../../../models/petro/commanderversion.model';
import { SchemaUploadComponent } from '../schemaupload.component';
import {TableTreeComponent } from '../treeview/tabletree.component';
import { XmlPipe } from '../../../../pipes/XmlPipe';
import { LoadingComponent } from '../../loading.component';
import { ViewChildren, ViewChild } from '@angular/core';

let version: commanderbaseversion = { versionDescription: 'testVersion', versionID: 823, createdByUser: 'CXu', createdDate: '' };
let mockdata: PetroTable[] = [{
    "tableID": 532, "tableName": "Dictionary", "versionID": 823, "active": true, "definitionOnly": true,
    "schemaDef": "<!-- edited with XMLSpy v2008 (http://www.altova.com) by Bradford Loewy (VERIFONE) --><!-- edited with XMLSPY v2004 rel. 3 U (http://www.xmlspy.com) by Bradford Loewy (VeriFone, Inc.) --><xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns=\"http://www.verifone.com/eps/viper/namespace/Dictionary/v1\" targetNamespace=\"http://www.verifone.com/eps/viper/namespace/Dictionary/v1\" elementFormDefault=\"qualified\" attributeFormDefault=\"unqualified\"><xs:simpleType name=\"RegExType\"><xs:annotation><xs:documentation>Regular Expression</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\" /></xs:simpleType><xs:simpleType name=\"VersionType\"><xs:annotation><xs:documentation>Table Version</xs:documentation></xs:annotation><xs:restriction base=\"xs:decimal\" /></xs:simpleType><xs:simpleType name=\"DigitIndexOneType\"><xs:annotation><xs:documentation>Index of length 1 and type string</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:pattern value=\"\\d\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"DigitIndexTwoType\"><xs:annotation><xs:documentation>Index of length 2 and type string</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:pattern value=\"\\d{2}\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"StringIndexThreeType\"><xs:annotation><xs:documentation>Index of length 3 and type string</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:pattern value=\"\\d\\d\\d\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"StringIndexFourType\"><xs:annotation><xs:documentation>Index of length 4 and type string</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:pattern value=\"\\d\\d\\d\\d\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"DigitIndexSixType\"><xs:annotation><xs:documentation>Index of length 6 and type string</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:pattern value=\"\\d{6}\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"DigitIndexEightType\"><xs:annotation><xs:documentation>Index of length 8 and type string</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:pattern value=\"\\d{8}\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"ActionCodeType\"><xs:annotation><xs:documentation>Action Code</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:maxLength value=\"20\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"CardHandlingRoutineIndType\"><xs:annotation><xs:documentation>Card Handling Routine Index</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:pattern value=\"\\d\\d\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"ActionCodehandlerIndType\"><xs:annotation><xs:documentation>Card Handling Routine Index</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:pattern value=\"\\d\\d\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"FeeIndicatorType\"><xs:annotation><xs:documentation>Fee Indicator</xs:documentation></xs:annotation><xs:restriction base=\"xs:integer\" /></xs:simpleType><xs:simpleType name=\"FeeIndexType\"><xs:annotation><xs:documentation>Fee Index</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:pattern value=\"\\d\\d\\d\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"FEPIndicatorType\"><xs:annotation><xs:documentation>FEP Indicator</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:pattern value=\"\\d\\d\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"FEPNameType\"><xs:annotation><xs:documentation>FEP Name</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:maxLength value=\"20\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"FEPTypeType\"><xs:annotation><xs:documentation>FEP Type</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:enumeration value=\"Payment\" /><xs:enumeration value=\"Prepaid\" /><xs:enumeration value=\"Loyalty\" /><xs:enumeration value=\"EBT\" /><xs:enumeration value=\"Other\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"FieldUsageIdType\"><xs:annotation><xs:documentation>Field Usage Identifier</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:minLength value=\"0\" /><xs:maxLength value=\"25\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"LCIType\"><xs:annotation><xs:documentation>Logic Control Index</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:maxLength value=\"20\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"LimitIndexType\"><xs:annotation><xs:documentation>Limit Index</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:maxLength value=\"20\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"LogicIndicatorType\"><xs:annotation><xs:documentation>Logic Indicator</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:maxLength value=\"20\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"MaskingTableIndexType\"><xs:annotation><xs:documentation>Masking Table Index</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:maxLength value=\"20\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"PriceTierType\"><xs:restriction base=\"xs:string\"><xs:enumeration value=\"cash\" /><xs:enumeration value=\"credit\" /><xs:enumeration value=\"debit\" /><xs:enumeration value=\"storedValue\" /><xs:enumeration value=\"fleet\" /><xs:enumeration value=\"proprietary\" /><xs:enumeration value=\"loyalty\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"ProductIndType\"><xs:annotation><xs:documentation>Product Index</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:pattern value=\"\\d\\d\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"PromptIdType\"><xs:annotation><xs:documentation>Prompt ID</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:maxLength value=\"25\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"PromptIndicatorType\"><xs:annotation><xs:documentation>Prompt Indicator</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:maxLength value=\"20\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"ActionCodeHandlerIdType\"><xs:restriction base=\"xs:string\"><xs:minLength value=\"1\" /><xs:maxLength value=\"20\" /><xs:pattern value=\"\\d*\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"ActionCodeHandlerIndicatorType\"><xs:annotation><xs:documentation>Action Code Indicator</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:pattern value=\"\\d\\d\\d\\d\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"ReceiptIndicatorType\"><xs:annotation><xs:documentation>Receipt Indicator</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:maxLength value=\"20\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"ValidationIndicatorType\"><xs:annotation><xs:documentation>Validation Indicator</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:maxLength value=\"25\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"ValidationIndexType\"><xs:annotation><xs:documentation>Validation ID</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:maxLength value=\"25\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"ReceiptIndexType\"><xs:annotation><xs:documentation>Receipt Index</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:maxLength value=\"20\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"VelocityGrpIndType\"><xs:annotation><xs:documentation>Velocity Group Index</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:pattern value=\"\\d\\d\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"NACSProductCodeType\"><xs:annotation><xs:documentation>NACS Product Code</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:pattern value=\"\\d\\d\\d\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"IPAddressType\"><xs:annotation><xs:documentation>IP Address formatted xxx.xxx.xxx.xxx</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:pattern value=\"\\d{1,3}.\\d{1,3}.\\d{1,3}.\\d{1,3}\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"SerialAddressType\"><xs:annotation><xs:documentation>Serial Address</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\" /></xs:simpleType><xs:simpleType name=\"TCPPort\"><xs:annotation><xs:documentation>IP Port</xs:documentation></xs:annotation><xs:restriction base=\"xs:integer\"><xs:minInclusive value=\"1\" /><xs:maxInclusive value=\"65535\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"SerialPort\"><xs:annotation><xs:documentation>Serial communication port that the hardware will use.</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:enumeration value=\"COM0\" /><xs:enumeration value=\"COM1\" /><xs:enumeration value=\"COM2\" /><xs:enumeration value=\"COM3\" /><xs:enumeration value=\"COM4\" /><xs:enumeration value=\"COM5\" /><xs:enumeration value=\"COM6\" /><xs:enumeration value=\"TTYS1\" /><xs:enumeration value=\"PortA1-1\" /><xs:enumeration value=\"PortA1-2\" /><xs:enumeration value=\"PortA1-3\" /><xs:enumeration value=\"PortA1-4\" /><xs:enumeration value=\"PortA1-5\" /><xs:enumeration value=\"PortA1-6\" /><xs:enumeration value=\"PortA1-7\" /><xs:enumeration value=\"PortA1-8\" /><xs:enumeration value=\"PortA2-1\" /><xs:enumeration value=\"PortA2-2\" /><xs:enumeration value=\"PortA2-3\" /><xs:enumeration value=\"PortA2-4\" /><xs:enumeration value=\"PortA2-5\" /><xs:enumeration value=\"PortA2-6\" /><xs:enumeration value=\"PortA2-7\" /><xs:enumeration value=\"PortA2-8\" /><xs:enumeration value=\"PortA3-1\" /><xs:enumeration value=\"PortA3-2\" /><xs:enumeration value=\"PortA3-3\" /><xs:enumeration value=\"PortA3-4\" /><xs:enumeration value=\"PortA3-5\" /><xs:enumeration value=\"PortA3-6\" /><xs:enumeration value=\"PortA3-7\" /><xs:enumeration value=\"PortA3-8\" /></xs:restriction></xs:simpleType><xs:attributeGroup name=\"ViperPort\"><xs:annotation><xs:documentation>Optional port Channel and Codec packages</xs:documentation></xs:annotation><xs:attribute name=\"ChannelClassName\" use=\"optional\" default=\"com.verifone.isd.viper.eps.pres.channels.ip.IpChannel\"><xs:simpleType><xs:restriction base=\"xs:string\"><xs:enumeration value=\"com.verifone.isd.viper.eps.pres.channels.ip.IpChannel\" /><xs:enumeration value=\"com.verifone.isd.viper.eps.pres.channels.serial.SerialChannel\" /></xs:restriction></xs:simpleType></xs:attribute><xs:attribute name=\"CodecClassName\" use=\"optional\" default=\"com.verifone.isd.viper.eps.pres.codecs.IFSF.IFSFCodec\"><xs:simpleType><xs:restriction base=\"xs:string\"><xs:enumeration value=\"com.verifone.isd.viper.eps.pres.codecs.IFSF.IFSFCodec\" /><xs:enumeration value=\"com.verifone.isd.viper.eps.pres.codecs.serial.SerialCodec\" /></xs:restriction></xs:simpleType></xs:attribute></xs:attributeGroup><xs:attributeGroup name=\"ViperPOPPort\"><xs:annotation><xs:documentation>Optional port Channel and Codec packages</xs:documentation></xs:annotation><xs:attribute name=\"ChannelClassName\" type=\"xs:string\" use=\"optional\" default=\"com.verifone.isd.viper.eps.pres.channels.ip.IpChannel\" /><xs:attribute name=\"CodecClassName\" type=\"xs:string\" use=\"optional\" default=\"com.verifone.isd.viper.eps.pres.codecs.pop.PopCodec\" /></xs:attributeGroup><xs:complexType name=\"ViperTCPPort\"><xs:annotation><xs:documentation>Port plus optional Channel and Codec packages</xs:documentation></xs:annotation><xs:simpleContent><xs:extension base=\"TCPPort\"><xs:attributeGroup ref=\"ViperPort\" /></xs:extension></xs:simpleContent></xs:complexType><xs:complexType name=\"ViperPOPTCPPort\"><xs:annotation><xs:documentation>Port plus optional Channel and Codec packages</xs:documentation></xs:annotation><xs:simpleContent><xs:extension base=\"TCPPort\"><xs:attributeGroup ref=\"ViperPOPPort\" /></xs:extension></xs:simpleContent></xs:complexType><xs:complexType name=\"ViperSerialPort\"><xs:annotation><xs:documentation>Port plus optional Channel and Codec packages (not functional for Serial)</xs:documentation></xs:annotation><xs:simpleContent><xs:extension base=\"SerialPort\"><xs:attributeGroup ref=\"ViperPort\" /></xs:extension></xs:simpleContent></xs:complexType><xs:complexType name=\"ViperPOPSerialPort\"><xs:annotation><xs:documentation>Port plus optional Channel and Codec packages (not functional for Serial)</xs:documentation></xs:annotation><xs:simpleContent><xs:extension base=\"SerialPort\"><xs:attributeGroup ref=\"ViperPOPPort\" /></xs:extension></xs:simpleContent></xs:complexType><xs:simpleType name=\"TrackMaskTableIndexType\"><xs:annotation><xs:documentation>Track Masking Table Index</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:pattern value=\"\\d\\d\\d\\d\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"ICCParamsIdType\"><xs:annotation><xs:documentation>ICCParams ID</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:maxLength value=\"25\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"ICCParamType\"><xs:annotation><xs:documentation>Parameters used to exchange information with an ICC capable device. Parameters in this list apply for ICC card processing but are not defined by a standard EMV tag\t</xs:documentation></xs:annotation><xs:restriction base=\"xs:string\"><xs:enumeration value=\"AIDName\" /><xs:enumeration value=\"CAPKChecksum\" /><xs:enumeration value=\"CAPKExpDate\" /><xs:enumeration value=\"CAPKExponent\" /><xs:enumeration value=\"CAPKModulus\" /><xs:enumeration value=\"CtlsCVMLimit\" /><xs:enumeration value=\"CtlsTransactionLimit\" /><xs:enumeration value=\"CtlsTransactionScheme\" /><xs:enumeration value=\"CtlsVisaTTQ\" /><xs:enumeration value=\"DDOLDefault\" /><xs:enumeration value=\"EncipheredPINBlock\" /><xs:enumeration value=\"EnableICC\" /><xs:enumeration value=\"EnableRemoteAIDSelection\" /><xs:enumeration value=\"HashAlgorithmIndicator\" /><xs:enumeration value=\"HostDecision\" /><xs:enumeration value=\"LanguageCodeDefault\" /><xs:enumeration value=\"MaxRandomSelectionPercent\" /><xs:enumeration value=\"MerchantDecision\" /><xs:enumeration value=\"PinBypassFlag\" /><xs:enumeration value=\"PinEntryTimeOut\" /><xs:enumeration value=\"RandomSelectionThreshold\" /><xs:enumeration value=\"RID\" /><xs:enumeration value=\"RIDName\" /><xs:enumeration value=\"ScriptResult\" /><xs:enumeration value=\"SignAlgorithmIndicator\" /><xs:enumeration value=\"TACDefault\" /><xs:enumeration value=\"TACDenial\" /><xs:enumeration value=\"TACOnline\" /><xs:enumeration value=\"TargetRandomSelectionPercent\" /><xs:enumeration value=\"TDOLDefault\" /><xs:enumeration value=\"TerminalApplicationVersionNumber2\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"PromptRoutineType\"><xs:annotation><xs:documentation>Prompt Validation Routine index</xs:documentation></xs:annotation><xs:restriction base=\"xs:integer\"><xs:minInclusive value=\"0\" /><xs:maxInclusive value=\"999\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"ModeTypes\"><xs:restriction base=\"xs:string\"><xs:enumeration value=\"Contact\" /><xs:enumeration value=\"Contactless\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"AIDType\"><xs:restriction base=\"xs:string\"><xs:minLength value=\"10\" /><xs:maxLength value=\"32\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"UsageFlag\"><xs:restriction base=\"xs:string\"><xs:enumeration value=\"0\" /><xs:enumeration value=\"1\" /><xs:enumeration value=\"2\" /><xs:enumeration value=\"3\" /><xs:enumeration value=\"4\" /><xs:enumeration value=\"5\" /><xs:enumeration value=\"6\" /><xs:enumeration value=\"7\" /><xs:enumeration value=\"8\" /><xs:enumeration value=\"9\" /><xs:enumeration value=\"10\" /><xs:enumeration value=\"99\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"CAPKIdType\"><xs:restriction base=\"xs:string\"><xs:maxLength value=\"25\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"PinBypassType\"><xs:restriction base=\"xs:string\"><xs:enumeration value=\"0\" /><xs:enumeration value=\"1\" /></xs:restriction></xs:simpleType><xs:simpleType name=\"RuleIdType\"><xs:restriction base=\"xs:string\"><xs:maxLength value=\"25\" /></xs:restriction></xs:simpleType></xs:schema>", "defaultXML": "", "createdDate": "2017-09-18T07:46:42.623", "effectiveDate": "2017-09-18T00:00:00", "lastUpdatedBy": "CXu", "lastUpdatedDate": "2017-09-18T07:46:42.623"
}, { "tableID": 533, "tableName": "EPSGeneralParameters", "versionID": 823, "active": true, "definitionOnly": false, "schemaDef": "<!-- edited with XMLSpy v2008 (http://www.altova.com) by Bradford Loewy (VERIFONE) --><!-- edited with XMLSPY v2004 rel. 3 U (http://www.xmlspy.com) by Clerley Silveira (VeriFone, Inc.) --><xs:schema xmlns:tt=\"http://www.verifone.com/eps/viper/namespace/Dictionary/v1\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns=\"http://www.verifone.com/eps/viper/namespace/v1\" targetNamespace=\"http://www.verifone.com/eps/viper/namespace/v1\" elementFormDefault=\"qualified\" attributeFormDefault=\"unqualified\"><xs:import namespace=\"http://www.verifone.com/eps/viper/namespace/Dictionary/v1\" schemaLocation=\"Dictionary.xsd\" /><xs:element name=\"EPSGeneralParameters\"><xs:annotation><xs:documentation>EPS General Parameters Table</xs:documentation></xs:annotation><xs:complexType><xs:sequence><xs:element name=\"SiteName\" type=\"xs:string\"><xs:annotation><xs:documentation>Name of the store location (i.e. Bradford�s Convenience Store)</xs:documentation></xs:annotation></xs:element><xs:element name=\"SiteID\" type=\"xs:string\"><xs:annotation><xs:documentation>Site ID as known from the system providing the EPS tables. (may be used on receipts, reports, asset page)</xs:documentation></xs:annotation></xs:element><xs:element name=\"SiteTimeSyncControl\"><xs:annotation><xs:documentation>Determines is POS or FEP controls EPS time.  �POS�: EPS Time is controlled by the POS.  If the time is to be controlled by a FEP, this should be the FEPName corresponding to that field in the FEPTable.</xs:documentation></xs:annotation><xs:simpleType><xs:restriction base=\"xs:string\" /></xs:simpleType></xs:element><xs:element name=\"SitePrimaryCurrencyCode\" type=\"xs:string\"><xs:annotation><xs:documentation>Site Primary Currency Code (used by the FEP)</xs:documentation></xs:annotation></xs:element><xs:element name=\"SiteAlternativeCurrencyCode\" type=\"xs:string\" minOccurs=\"0\"><xs:annotation><xs:documentation>Site Secondary Currency Code (used by the FEP)</xs:documentation></xs:annotation></xs:element><xs:element name=\"SitePrimaryISOCurrencyCode\" type=\"xs:string\"><xs:annotation><xs:documentation>Site Primary Currency Code - ISO 4217 format</xs:documentation></xs:annotation></xs:element><xs:element name=\"SiteAlternativeISOCurrencyCode\" type=\"xs:string\" minOccurs=\"0\"><xs:annotation><xs:documentation>Site Secondary Currency Code - ISO 4217 format</xs:documentation></xs:annotation></xs:element><xs:element name=\"SitePrimaryLanguageCode\" type=\"xs:string\"><xs:annotation><xs:documentation>Site Primary Language Code - ISO 639 format</xs:documentation></xs:annotation></xs:element><xs:element name=\"SiteAlternative1LanguageCode\" type=\"xs:string\" minOccurs=\"0\"><xs:annotation><xs:documentation>Site Alternative 1 Language Code - ISO 639  format</xs:documentation></xs:annotation></xs:element><xs:element name=\"SiteAlternative2LanguageCode\" type=\"xs:string\" minOccurs=\"0\"><xs:annotation><xs:documentation>Site Alternative 2 Language Code - ISO 639  format</xs:documentation></xs:annotation></xs:element><xs:element name=\"SiteSendPOSAdminMessages\" type=\"xs:boolean\"><xs:annotation><xs:documentation>Flag to control the forwarding to the host of POS Admin Messages.  Setting this flag to false will prevent the forwarding to he FEP of any POS admin messages the EPS receives.</xs:documentation></xs:annotation></xs:element><xs:element name=\"FEPIndicatorForPOSAdmin1Messages\" type=\"xs:string\" minOccurs=\"0\"><xs:annotation><xs:documentation>Reference into the FEPIndicatorTable to override to which FEP POSAdmin1 Messages are sent</xs:documentation></xs:annotation></xs:element><xs:element name=\"FEPIndicatorForPOSAdmin2Messages\" type=\"xs:string\" minOccurs=\"0\"><xs:annotation><xs:documentation>Reference into the FEPIndicatorTable to override to which FEP POSAdmin2 Messages are sent</xs:documentation></xs:annotation></xs:element><xs:element name=\"FEPIndicatorForPOSAdmin3Messages\" type=\"xs:string\" minOccurs=\"0\"><xs:annotation><xs:documentation>Reference into the FEPIndicatorTable to override to which FEP POSAdmin3 Messages are sent</xs:documentation></xs:annotation></xs:element><xs:element name=\"FEPIndicatorForPOSAdmin4Messages\" type=\"xs:string\" minOccurs=\"0\"><xs:annotation><xs:documentation>Reference into the FEPIndicatorTable to override to which FEP POSAdmin4 Messages are sent</xs:documentation></xs:annotation></xs:element><xs:element name=\"SiteSendEPSAdminMessages\" type=\"xs:boolean\"><xs:annotation><xs:documentation>Flag to control the forwarding to the host of EPSAdmin Messages.  Setting this flag to false will prevent the forwarding to he FEP of all EPS admin messages.</xs:documentation></xs:annotation></xs:element><xs:element name=\"FEPIndicatorForEPSAdmin1Messages\" type=\"xs:string\" minOccurs=\"0\"><xs:annotation><xs:documentation>Reference into the FEPIndicatorTable to override to which FEP EPSAdmin1 Messages are sent</xs:documentation></xs:annotation></xs:element><xs:element name=\"FEPIndicatorForEPSAdmin2Messages\" type=\"xs:string\" minOccurs=\"0\"><xs:annotation><xs:documentation>Reference into the FEPIndicatorTable to override to which FEP EPSAdmin2 Messages are sent</xs:documentation></xs:annotation></xs:element><xs:element name=\"FEPIndicatorForEPSAdmin3Messages\" type=\"xs:string\" minOccurs=\"0\"><xs:annotation><xs:documentation>Reference into the FEPIndicatorTable to override to which FEP EPSAdmin3 Messages are sent</xs:documentation></xs:annotation></xs:element><xs:element name=\"FEPIndicatorForEPSAdmin4Messages\" type=\"xs:string\" minOccurs=\"0\"><xs:annotation><xs:documentation>Reference into the FEPIndicatorTable to override to which FEP EPSAdmin4 Messages are sent</xs:documentation></xs:annotation></xs:element><xs:element name=\"ConfigMessage\" type=\"xs:string\" minOccurs=\"0\"><xs:annotation><xs:documentation>Reference store defined declined message when the feature is enabled</xs:documentation></xs:annotation></xs:element><xs:element name=\"NetworkLastRequired\" type=\"xs:boolean\"><xs:annotation><xs:documentation>True - The site does not support split tender or requires that the network transaction is last ; False - The site supports split tender of network transactions</xs:documentation></xs:annotation></xs:element><xs:element name=\"CashBackPrompt\" type=\"xs:boolean\"><xs:annotation><xs:documentation>True - The site may prompt for cash back on cards that permit cash back ; False - The site is not allowed to prompt for cash back, regardless of the flag on the individual card</xs:documentation></xs:annotation></xs:element><xs:element name=\"DualCardProcessingCode\"><xs:annotation><xs:documentation>Controls how cards that can be processed as either credit or debit are handled</xs:documentation></xs:annotation><xs:simpleType><xs:restriction base=\"xs:string\"><xs:enumeration value=\"ForceDebit\"><xs:annotation><xs:documentation>MOP Type will be forced to Debit</xs:documentation></xs:annotation></xs:enumeration><xs:enumeration value=\"ForceCredit\"><xs:annotation><xs:documentation>MOP Type will be forced to Credit</xs:documentation></xs:annotation></xs:enumeration><xs:enumeration value=\"CustomerSelect\"><xs:annotation><xs:documentation>Customer will be prompted for MOP Type</xs:documentation></xs:annotation></xs:enumeration><xs:enumeration value=\"POSSelect\"><xs:annotation><xs:documentation>Cashier will be prompted for MOP Type</xs:documentation></xs:annotation></xs:enumeration></xs:restriction></xs:simpleType></xs:element><xs:element name=\"OverallStoreAndForward\"><xs:annotation><xs:documentation>Maximum number of transactions allowed in the EPS Store and Forward</xs:documentation></xs:annotation><xs:simpleType><xs:restriction base=\"xs:integer\"><xs:minInclusive value=\"0\" /><xs:maxInclusive value=\"9999\" /></xs:restriction></xs:simpleType></xs:element><xs:element name=\"NumberDaysDataStored\"><xs:annotation><xs:documentation>Number of days to worth of data the EPS will store</xs:documentation></xs:annotation><xs:simpleType><xs:restriction base=\"xs:integer\"><xs:minInclusive value=\"1\" /><xs:maxInclusive value=\"30\" /></xs:restriction></xs:simpleType></xs:element><xs:element name=\"PayPointBatchDayCloseTime\"><xs:annotation><xs:documentation>Time of day for PayPoint Batch Close.  HH:MM in 24hr time.  Seconds are defautled to 0.</xs:documentation></xs:annotation><xs:simpleType><xs:restriction base=\"xs:string\"><xs:pattern value=\"([0-1][0-9]|2[0-3]):[0-5][0-9]\" /></xs:restriction></xs:simpleType></xs:element><xs:element name=\"SecurityDayCount\"><xs:annotation><xs:documentation>Amount of days after which certain steps will be followed to maximize security.</xs:documentation></xs:annotation><xs:simpleType><xs:restriction base=\"xs:integer\"><xs:minInclusive value=\"1\" /></xs:restriction></xs:simpleType></xs:element><xs:element name=\"ReportMaskingFlag\" type=\"xs:boolean\"><xs:annotation><xs:documentation>True - The site to mask account number on acquirer batch report; False - The site to unmask account number on acquirer batch report</xs:documentation></xs:annotation></xs:element><xs:element name=\"LoyaltyReportMaskingFlag\" type=\"xs:boolean\" minOccurs=\"0\"><xs:annotation><xs:documentation>True - The site to mask account number on Loyalty report; False - The site to unmask account number on Loyalty report</xs:documentation></xs:annotation></xs:element><xs:element name=\"ClearVelocityHoursCount\" type=\"xs:integer\" minOccurs=\"0\"><xs:annotation><xs:documentation>The number of hours velocity will wait before clearing any entry</xs:documentation></xs:annotation></xs:element><xs:element name=\"OnLineVelocityCheck\" type=\"xs:boolean\" minOccurs=\"0\"><xs:annotation><xs:documentation>If enabled velocity will be checked for online transaction as well as offline transactions</xs:documentation></xs:annotation></xs:element><xs:element name=\"SignatureCaptureEnabled\" type=\"xs:boolean\" minOccurs=\"0\" /><xs:element name=\"DisplaySignatureToCashier\" type=\"xs:boolean\" minOccurs=\"0\" /><xs:element name=\"PrintSignatureOnReceipt\" type=\"xs:boolean\" minOccurs=\"0\" /><xs:element name=\"OutsideCashierMessageSupported\" type=\"xs:boolean\" minOccurs=\"0\"><xs:annotation><xs:documentation>True - Allow prompts with TargetUserType=POS to be sent during outside transactions for display to the cashier (e.g. help icon message); False - Prevent prompt with TargetUserType=POS from being sent during outdoor transaction.  POS/DCR subsystem to rely on POS generated default message instead</xs:documentation></xs:annotation></xs:element><xs:element name=\"CashbackFeeIndicator\" type=\"tt:FeeIndicatorType\" minOccurs=\"0\"><xs:annotation><xs:documentation>Points to the cashback fee indicator in the FeeTable or 0 if none</xs:documentation></xs:annotation></xs:element><xs:element name=\"EBTCashbackFeeIndicator\" type=\"tt:FeeIndicatorType\" minOccurs=\"0\"><xs:annotation><xs:documentation>Points to the cashback fee indicator in the FeeTable or 0 if none</xs:documentation></xs:annotation></xs:element><xs:element name=\"DisallowKioskEPSSplitTender\" type=\"xs:boolean\" default=\"false\" minOccurs=\"0\" /><xs:element name=\"TerminalBatchLimit\" minOccurs=\"0\"><xs:annotation><xs:documentation>Maximum terminal batches allowed</xs:documentation></xs:annotation><xs:simpleType><xs:restriction base=\"xs:integer\"><xs:minInclusive value=\"1\" /><xs:maxInclusive value=\"99999\" /></xs:restriction></xs:simpleType></xs:element><xs:element name=\"DisplayPINpadPromptsToCashier\" type=\"xs:boolean\" default=\"false\" minOccurs=\"0\"><xs:annotation><xs:documentation>Gives visibility to cashier on input prompts displayed on PINpad</xs:documentation></xs:annotation></xs:element><xs:element name=\"UseStoreError\" type=\"xs:boolean\" default=\"false\" minOccurs=\"0\"><xs:annotation><xs:documentation>Enables the Cashier to define a message to be displayed on the DCR</xs:documentation></xs:annotation></xs:element></xs:sequence><xs:attribute name=\"version\" type=\"tt:VersionType\" use=\"required\" /></xs:complexType></xs:element></xs:schema>", "defaultXML": "<!-- edited with XMLSPY v2004 rel. 3 U (http://www.xmlspy.com) by Bradford Loewy (VeriFone, Inc.) --><EPSGeneralParameters xmlns=\"http://www.verifone.com/eps/viper/namespace/v1\" xmlns:tt=\"http://www.verifone.com/eps/viper/namespace/Dictionary/v1\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" version=\"0\" xsi:schemaLocation=\"http://www.verifone.com/eps/viper/namespace/v1 ../schemas/tables/EPSGeneralParametersTable.xsd\"><SiteName>VeriFone Gold Disk</SiteName><SiteID>9999999</SiteID><SiteTimeSyncControl>worldpay</SiteTimeSyncControl><SitePrimaryCurrencyCode>840</SitePrimaryCurrencyCode><SiteAlternativeCurrencyCode /><SitePrimaryISOCurrencyCode>USD</SitePrimaryISOCurrencyCode><SiteAlternativeISOCurrencyCode>USD</SiteAlternativeISOCurrencyCode><SitePrimaryLanguageCode>en</SitePrimaryLanguageCode><SiteAlternative1LanguageCode /><SiteAlternative2LanguageCode /><SiteSendPOSAdminMessages>true</SiteSendPOSAdminMessages><FEPIndicatorForPOSAdmin1Messages>01</FEPIndicatorForPOSAdmin1Messages><FEPIndicatorForPOSAdmin2Messages>01</FEPIndicatorForPOSAdmin2Messages><FEPIndicatorForPOSAdmin3Messages>01</FEPIndicatorForPOSAdmin3Messages><FEPIndicatorForPOSAdmin4Messages /><SiteSendEPSAdminMessages>true</SiteSendEPSAdminMessages><FEPIndicatorForEPSAdmin1Messages>01</FEPIndicatorForEPSAdmin1Messages><FEPIndicatorForEPSAdmin2Messages>01</FEPIndicatorForEPSAdmin2Messages><FEPIndicatorForEPSAdmin3Messages>01</FEPIndicatorForEPSAdmin3Messages><FEPIndicatorForEPSAdmin4Messages>01</FEPIndicatorForEPSAdmin4Messages><NetworkLastRequired>false</NetworkLastRequired><CashBackPrompt>true</CashBackPrompt><DualCardProcessingCode>CustomerSelect</DualCardProcessingCode><OverallStoreAndForward>500</OverallStoreAndForward><NumberDaysDataStored>15</NumberDaysDataStored><PayPointBatchDayCloseTime>00:00</PayPointBatchDayCloseTime><SecurityDayCount>2</SecurityDayCount><ReportMaskingFlag>false</ReportMaskingFlag><ClearVelocityHoursCount>01</ClearVelocityHoursCount><OnLineVelocityCheck>true</OnLineVelocityCheck><SignatureCaptureEnabled>true</SignatureCaptureEnabled><DisplaySignatureToCashier>true</DisplaySignatureToCashier><PrintSignatureOnReceipt>true</PrintSignatureOnReceipt><OutsideCashierMessageSupported>true</OutsideCashierMessageSupported><CashbackFeeIndicator>1</CashbackFeeIndicator></EPSGeneralParameters>", "createdDate": "2017-09-18T07:47:27.84", "effectiveDate": "2017-09-18T00:00:00", "lastUpdatedBy": "CXu", "lastUpdatedDate": "2017-09-18T07:47:27.84" }]

describe('TableSchema Component', () => {
    let fixture: ComponentFixture<TableSchemaComponent>,
        parentFixture: ComponentFixture<SchemaUploadComponent>,
        comp: TableSchemaComponent,
        parent: SchemaUploadComponent,
        debugElement: DebugElement,
        element: HTMLElement;

    beforeEach(async(() => {
        TestBed.resetTestEnvironment();
        TestBed.initTestEnvironment(
            BrowserDynamicTestingModule,
            platformBrowserDynamicTesting()
        );
        TestBed.configureTestingModule({
            imports: [FormsModule, HttpModule, BrowserAnimationsModule, ReactiveFormsModule,
                NoopAnimationsModule, DataTableModule, TabViewModule, DialogModule, ButtonModule,
                CheckboxModule, DropdownModule, FileUploadModule, TreeModule, ConfirmDialogModule,
                PanelModule, GrowlModule, MessagesModule, AutoCompleteModule, CalendarModule],
            declarations: [TableSchemaComponent, SchemaUploadComponent, TableTreeComponent,
                XmlPipe, LoadingComponent],
            providers: [
               
            ]
        });
    
    }));

    beforeEach(() => {
        fixture = TestBed.createComponent(TableSchemaComponent);
        comp = fixture.componentInstance;
        parentFixture = TestBed.createComponent(SchemaUploadComponent);
        parent = parentFixture.componentInstance;
        debugElement = fixture.debugElement;
        element = debugElement.nativeElement;
        parent.version = version;
        parent.petroTables = mockdata;
        parent.selectedTable = mockdata[1];
        parent.editTable = mockdata[1];
        parent.msgs = [];
        comp.parent = parent;
    });


    it('TableSchema should create the app', async(() => {
        let app = fixture.debugElement.componentInstance;
        expect(app).toBeTruthy();
    }));

    it('should display tableName', async(() => {
        comp.table = parent.editTable;

        comp.ngOnChanges({
            table: new SimpleChange(null, comp.table,true)
        });
        fixture.detectChanges();

        let tableName = fixture.debugElement.query(By.css('#tableName')).nativeElement;
        expect(tableName.textContent.trim()).toEqual('EPSGeneralParameters');
               
    }));

    it('should display table description', async(() => {
        comp.table = parent.editTable;

        comp.ngOnChanges({
            table: new SimpleChange(null, comp.table, true)
        });
        fixture.detectChanges();

        let description = fixture.debugElement.query(By.css('#versionDescription')).nativeElement;
        expect(description.textContent.trim()).toEqual('testVersion');
       
    }));

    it('should call Submit when click on Save button', async(() => {
        comp.table = parent.editTable;
        comp.ngOnChanges({
            table: new SimpleChange(null, comp.table, true)
        });
        fixture.detectChanges();
        spyOn(comp, 'Submit');
        let bSubmit = fixture.debugElement.query(By.css('#bSubmit')).nativeElement;        
        bSubmit.click();

        fixture.whenStable().then(() => {
            expect(comp.Submit).toHaveBeenCalled();
        })
    }));

    it('should call Cancel when click on Cancel button', async(() => {
        comp.table = parent.editTable;
        comp.ngOnChanges({
            table: new SimpleChange(null, comp.table, true)
        });
        fixture.detectChanges();
        spyOn(comp, 'cancel');
        let bCancel = fixture.debugElement.query(By.css('#bCancel')).nativeElement;
        bCancel.click();

        fixture.whenStable().then(() => {
            expect(comp.cancel).toHaveBeenCalled();
        })
    }));
});
